<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Quiz di Romaji Giapponese</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-color: #f9fafc;
      --text-color: #2e2e2e;
      --card-color: #ffffff;
      --accent-color: #4a69bd;
      --blur-color: #eef3f8;
    }
    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #f1f1f1;
      --card-color: #2a2a2a;
      --accent-color: #a2c0ff;
      --blur-color: #333740;
    }
    body {
      margin: 0;
      background: var(--bg-color);
      font-family: 'Poppins', sans-serif;
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }
    .layout { display: flex; flex-wrap: wrap; max-width:1300px; margin:0 auto; padding:40px 20px; gap:30px; }
    .container { flex:1; background:var(--card-color); border-radius:16px; box-shadow:0 4px 18px rgba(0,0,0,0.08); padding:30px; }
    .quiz-title { font-size:30px; margin-bottom:25px; text-align:center; color:var(--accent-color); font-weight:600; }
    .question { font-size:24px; text-align:center; margin-bottom:20px; }
    .input-group { text-align:center; margin-bottom:20px; }
    input {
      font-size:20px; padding:12px 16px; width:320px;
      border:2px solid #dcdfe6; border-radius:10px;
      background:var(--bg-color); color:var(--text-color);
      transition:all 0.3s;
    }
    input:focus { border-color:var(--accent-color); outline:none; }
    button {
      font-size:16px; padding:10px 18px; margin-left:10px;
      background:var(--accent-color); color:white;
      border:none; border-radius:8px; cursor:pointer;
      transition:background 0.3s;
    }
    .result { font-size:18px; margin-top:30px; line-height:1.6; }
    .explanation {
      background:var(--blur-color); padding:16px; margin-top:15px;
      border-left:5px solid var(--accent-color); border-radius:8px;
    }
    .sidebar {
      width:280px; background:var(--card-color); border-radius:16px;
      box-shadow:0 4px 12px rgba(0,0,0,0.04); padding:25px;
    }
    .sidebar h3 { margin-top:0; font-size:20px; color:var(--accent-color); }
    .sidebar ul { list-style:none; padding-left:0; }
    .sidebar li { margin-bottom:12px; }
    .blur { filter:blur(5px); transition:filter 0.3s; cursor:pointer; }
    .blur:hover { filter:blur(0); }
    .version {
      position:fixed; top:10px; left:20px; font-size:13px;
      color:#888; font-style:italic;
    }
    .toggle-theme {
      position:fixed; top:10px; right:20px; font-size:16px;
      padding:6px 10px; border-radius:8px;
      background:var(--accent-color); color:white;
      border:none; cursor:pointer;
    }
    .btn-blur {
      display:inline-block;
      font-size:14px; padding:6px 12px; margin-left:10px;
      background:var(--accent-color); color:white;
      border:none; border-radius:8px; cursor:pointer;
      transition:background 0.3s;
    }
  </style>
</head>
<body>
  <div class="version"></div>
  <button class="toggle-theme" id="toggleThemeBtn">Dark Mode</button>
  <div style="position:fixed; top:10px; right:160px; font-size:14px;">
    <span id="languageLabel">Lingua:</span>
    <span id="lang-it" style="cursor:pointer; margin:0 6px;">Italiano</span>|
    <span id="lang-en" style="cursor:pointer; margin:0 6px;">Inglese</span>
  </div>

  <div id="start-screen" style="text-align:center; padding:100px 20px;">
    <h1 style="font-size:36px; margin-bottom:20px;">Benvenuto al Quiz di Romaji</h1>
    <p style="font-size:18px; margin-bottom:30px;">
      Metti alla prova la tua conoscenza del giapponese!
    </p>
    <button id="startBtn" style="font-size:18px; padding:12px 24px;">
      Inizia il quiz
    </button>
  </div>

  <div class="layout" id="quiz-container" style="display:none;">
    <div class="container">
      <div class="quiz-title">Quiz di Romaji Giapponese</div>
      <div id="progress-bar" style="height:10px; background:#ddd; border-radius:8px; overflow:hidden; margin-bottom:15px;">
        <div id="progress-fill" style="height:100%; width:0%; background:var(--accent-color);"></div>
      </div>
      <div id="progress-text" style="text-align:center; font-size:14px; margin-bottom:15px;"></div>

      <div id="commandsContainer" style="text-align:center; font-size:14px; margin-bottom:10px;"></div>

      <div id="question" class="question"></div>
      <div class="input-group">
        <input type="text" id="userInput" />
        <button id="verifyBtn">Verifica</button>
      </div>
      <div class="result" id="result"></div>
      <div id="spiegazioni"></div>
    </div>
    <div class="sidebar">
      <h3>Parole Imparate</h3>
      <button id="copyWordsBtn" style="font-size:14px;">Copia parole</button>
      <button id="toggleBlurBtn" class="btn-blur">Mostra/Nascondi Romaji</button>
      <div id="conteggioParole" style="font-size:14px; margin:10px 0;"></div>
      <ul id="paroleSidebar"></ul>
    </div>
  </div>

  <!-- dati esterni -->
  <script src="new_romaji_quiz_data.js"></script>
  <script>
    // ============= testi multilanguage =============
    const labels = {
      it: {
        welcomeTitle: "Benvenuto al Quiz di Romaji",
        welcomeText: "Metti alla prova la tua conoscenza del giapponese!",
        startButton: "Inizia il quiz",
        learnedWords: "Parole Imparate",
        verifyButton: "Verifica",
        inputPlaceholder: "Scrivi in romaji",
        copyWords: "Copia parole",
        languageLabel: "Lingua:",
        commandsTitle: "Comandi",
        commandsText: "Invio = Verifica | Next = Avanti | Prev = Indietro",
        translate: "Traduci",
        restart: "Ricomincia da capo",
        retryWrong: "Ripeti solo quelle sbagliate",
        completed: "Hai completato il quiz!",
        finalScore: "Punteggio finale",
        themeDark: "Modalità Scura",
        themeLight: "Modalità Chiara",
        blurOn: "Mostra romaji",
        blurOff: "Nascondi romaji"
      },
      en: {
        welcomeTitle: "Welcome to the Romaji Quiz",
        welcomeText: "Test your knowledge of Japanese!",
        startButton: "Start the quiz",
        learnedWords: "Learned Words",
        verifyButton: "Check",
        inputPlaceholder: "Type in romaji",
        copyWords: "Copy words",
        languageLabel: "Language:",
        commandsTitle: "Shortcuts",
        commandsText: "Enter = Check | Next = Next | Prev = Back",
        translate: "Translate",
        restart: "Restart",
        retryWrong: "Repeat wrong ones",
        completed: "You’ve completed the quiz!",
        finalScore: "Final score",
        themeDark: "Dark Mode",
        themeLight: "Light Mode",
        blurOn: "Show romaji",
        blurOff: "Hide romaji"
      }
    };

    // ============= variabili globali =============
    let currentLang = 'it';
    let index = 0, score = 0;
    let wrongAnswers = [];
    let blurState = true;  // true = blur romaji

    // ============= funzioni =============
    function aggiornaTestiStatici() {
      const l = labels[currentLang];
      document.querySelector("#start-screen h1").textContent = l.welcomeTitle;
      document.querySelector("#start-screen p").textContent = l.welcomeText;
      document.getElementById("startBtn").textContent = l.startButton;
      document.querySelector(".quiz-title").textContent = l.welcomeTitle;
      document.querySelector(".sidebar h3").textContent = l.learnedWords;
      document.getElementById("userInput").placeholder = l.inputPlaceholder;
      document.getElementById("verifyBtn").textContent = l.verifyButton;
      document.getElementById("copyWordsBtn").textContent = l.copyWords;
      document.getElementById("languageLabel").textContent = l.languageLabel;
      document.getElementById("commandsContainer").innerHTML =
        `<strong>${l.commandsTitle}:</strong> ${l.commandsText}`;
      document.getElementById("toggleBlurBtn").textContent =
        blurState ? l.blurOff : l.blurOn;
      document.getElementById("toggleThemeBtn").textContent =
        document.body.classList.contains("dark") ? l.themeLight : l.themeDark;
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
      aggiornaTestiStatici();
    }

    function startQuiz() {
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("quiz-container").style.display = "flex";
      loadQuestion();
      popolaSidebar();
      updateScore();
      applyBlur();
    }

    function loadQuestion() {
      const q = data[index];
      document.getElementById("userInput").value = "";
      document.getElementById("result").innerHTML = "";
      document.getElementById("spiegazioni").innerHTML = "";
      const pct = Math.round((index / data.length) * 100);
      document.getElementById("progress-fill").style.width = pct + "%";
      document.getElementById("progress-text").textContent = `${index+1} / ${data.length}`;
      if (index < data.length) {
        document.getElementById("question").innerHTML =
          `<strong>${labels[currentLang].translate}:</strong> ` +
          q[currentLang==='it'? 'italiano' : 'inglese'];
      } else {
        endQuiz();
      }
    }

    function checkAnswer() {
      const input = document.getElementById("userInput").value.trim().toLowerCase();
      const correct = data[index].romaji.toLowerCase();
      if (input === correct) {
        const e = data[index];
        document.getElementById("result").innerHTML =
          `<strong>Frase:</strong><br>${e.frase}<br><em>${e.traduzione[currentLang]}</em>`;
        // particelle
        const spieg = { ...(e.spiegazioni||{}) };
        ["wa","o","ni","to"].forEach(p=>{
          if (!spieg[p] && e.frase.includes(` ${p} `))
            spieg[p] = spiegazioniGeneriche[p];
        });
        let html="";
        for(const k in spieg){
          const s = spieg[k];
          html +=
            `<div class="explanation"><strong>${k}</strong><br>`+
            `<em><strong>Descrizione:</strong></em> ${s.descrizione[currentLang]}<br>`+
            `<em><strong>Uso:</strong></em> ${s.uso[currentLang]}<br>`+
            `<em><strong>Esempio:</strong></em> ${s.esempio[currentLang]}<br>`+
            `<em><strong>Nota:</strong></em> ${s.nota[currentLang]}`+
            (s.perche?`<br><em><strong>${currentLang==='it'?'Perché':'Why'}:</strong></em> ${s.perche[currentLang]}`:"")+
            `</div>`;
        }
        document.getElementById("spiegazioni").innerHTML = html;
        score++;
        updateScore();
      } else {
        document.getElementById("result").innerHTML =
          `<span style="color:red;">✗ Risposta sbagliata. Riprova.</span>`;
        wrongAnswers.push(data[index]);
      }
    }

    function endQuiz() {
      document.getElementById("question").textContent = labels[currentLang].completed;
      document.querySelector(".input-group").style.display = "none";
      document.getElementById("progress-text").textContent =
        `${labels[currentLang].finalScore}: ${score} / ${data.length}`;
      document.getElementById("progress-fill").style.width = "100%";
      const res = document.getElementById("result");
      const btnR = document.createElement("button");
      btnR.textContent = labels[currentLang].restart;
      btnR.onclick = ()=> location.reload();
      res.appendChild(btnR);
      if (wrongAnswers.length) {
        const btnW = document.createElement("button");
        btnW.textContent = labels[currentLang].retryWrong;
        btnW.onclick = ()=>{
          data = [...wrongAnswers];
          index=0; score=0; wrongAnswers=[];
          document.querySelector(".input-group").style.display = "block";
          loadQuestion(); updateScore();
        };
        res.appendChild(btnW);
      }
    }

    function popolaSidebar() {
      const sb = document.getElementById("paroleSidebar");
      sb.innerHTML = "";
      data.forEach(e=>{
        const trad = currentLang==='it'? e.italiano : e.inglese;
        const li = document.createElement("li");
        li.innerHTML = `<span class="blur">${e.romaji}</span> – <span class="translation">${trad}</span>`;
        sb.appendChild(li);
      });
      document.getElementById("conteggioParole").textContent =
        currentLang==='it'
          ? `Totale: ${data.length} parole`
          : `Total: ${data.length} words`;
    }

    function applyBlur() {
      document.querySelectorAll("#paroleSidebar li .blur").forEach(el=>{
        if (blurState) el.classList.add("blur");
        else el.classList.remove("blur");
      });
      aggiornaTestiStatici();
    }

    function updateScore() {
      document.querySelector(".version").innerText =
        currentLang==='it' ? `Punteggio: ${score}` : `${labels.en.finalScore}: ${score}`;
    }

    // particelle
    const spiegazioniGeneriche = {
      wa: {
        descrizione: { it: "Particella del tema.", en: "Topic particle." },
        uso:       { it: "Indica il soggetto della frase.", en: "Marks the topic of the sentence." },
        esempio:   { it: "Watashi wa gakusei desu.", en: "I am a student." },
        nota:      { it: "Si scrive は ma si legge 'wa'.", en: "Written as は but pronounced 'wa'." },
        perche:    { it: "Watashi è il soggetto che compie l'azione.", en: "Watashi is the one performing the action." }
      },
      o: {
        descrizione: { it: "Particella dell’oggetto diretto.", en: "Direct object particle." },
        uso:         { it: "Introduce ciò che subisce l'azione.", en: "Marks what receives the action." },
        esempio:     { it: "Ringo o taberu.", en: "I eat an apple." },
        nota:        { it: "Si scrive を ma si legge 'o'.", en: "Written as を but pronounced 'o'." },
        perche:      { it: "L'oggetto che viene mangiato, guardato, ecc.", en: "The object being eaten, watched, etc." }
      },
      ni: {
        descrizione: { it: "Particella di destinazione o tempo.", en: "Direction or time particle." },
        uso:         { it: "Indica dove si va o quando.", en: "Indicates direction or time." },
        esempio:     { it: "Gakkou ni iku.", en: "I go to school." },
        nota:        { it: "Può indicare direzione, tempo o destinatario.", en: "Can mark direction, time, or recipient." },
        perche:      { it: "Serve per indicare la destinazione o il tempo.", en: "Used for destination or time indication." }
      },
      to: {
        descrizione: { it: "Particella connettiva (con).", en: "Connecting particle (with)." },
        uso:         { it: "Usata per indicare compagnia.", en: "Used to show companionship." },
        esempio:     { it: "Tomodachi to hanasu.", en: "I speak with a friend." },
        nota:        { it: "Collega due elementi o persone.", en: "Connects two elements or people." },
        perche:      { it: "Indica con chi si svolge l’azione.", en: "Shows with whom the action is done." }
      }
    };

    // ============= inizializzazione =============
    document.addEventListener("DOMContentLoaded", () => {
      // lingua
      document.getElementById("lang-it").onclick = ()=> setLanguage("it");
      document.getElementById("lang-en").onclick = ()=> setLanguage("en");
      // start quiz
      document.getElementById("startBtn").addEventListener("click", startQuiz);
      // verifica risposta
      document.getElementById("verifyBtn").addEventListener("click", checkAnswer);
      document.getElementById("userInput")
        .addEventListener("keydown", e => { if (e.key==="Enter") checkAnswer(); });
      // copia parole
      document.getElementById("copyWordsBtn").addEventListener("click", ()=>{
        const text = data.map(e=>
          `${e.romaji} – ${ currentLang==='it'? e.italiano : e.inglese }`
        ).join("\n");
        navigator.clipboard.writeText(text).then(()=> {
          alert(labels[currentLang].copyWords + "!");
        });
      });
      // toggle blur
      document.getElementById("toggleBlurBtn").addEventListener("click", ()=>{
        blurState = !blurState;
        applyBlur();
      });
      // tema
      if (localStorage.getItem("theme")==="dark")
        document.body.classList.add("dark");
      aggiornaTestiStatici();
      document.getElementById("toggleThemeBtn").addEventListener("click", toggleTheme);
      // carica lingua di default
      setLanguage(currentLang);
    });
  </script>
</body>
</html>
